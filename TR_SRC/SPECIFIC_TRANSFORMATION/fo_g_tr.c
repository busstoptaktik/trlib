/*
 * Copyright (c) 2011, National Survey and Cadastre, Denmark
 * (Kort- og Matrikelstyrelsen), kms@kms.dk
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */

/* Copyright (c) 2001 SPACE Danish Technical University (DTU)  */
/* All rights reserved.                                        */

/* This is unpublished proprietary source code of DTU SPACE    */
/* This copyright claim does not indicate an intention of      */
/* publishing this code.                                       */

#include    <stdio.h>
#include    <math.h>
#include    "KmsFncs.h"

int                      fo_g_tr(
/*______________________________*/
int                      mode,
int                      direct,
double                   N_in,
double                   E_in,
double                  *N_out,
double                  *E_out,
char                    *usertxt,
FILE                    *tr_error
)

{
/* Definition of the permissible area for the transformation */
#define COORDLIM     (2.0e5)        /* +/- 200 km */

  double           N, E, n, e, u, v, tol = 0.080; /*m*/
  double          *cb = NULL, *cw = NULL;
  double          *tcy, *tcx;
  int              res = 0, i, g, r, c, sz;

  /* Y&X-generelt pol. resultater
  utm29_etrs89 -> fu50
  grad:  8 pass: 5
  my  =  2.83 cm    my_loss =    +5  y_enp =  +3.9
  mx  =  2.76 cm    mx_loss =    +5  x_enp =  +4.2
  OBS =    472      red     =     1  m_lim_gen:  0.283
  */

  static double U29_FU50[] = {
    /*deg*/  8.0,
    /*Poly NORTH :: e-degree =  0  : n-degree =  8 */
    /*  0*/   6.8796613639e+06,   1.0000305263e+00,   3.0740212800e-11,
    /*  3*/   1.5354510577e-14,  -2.8203309391e-20,  -1.6919673641e-23,
    /*  6*/  -5.7805855134e-29,   5.7928761160e-33,   5.5368583096e-38,
    /*Poly NORTH :: e-degree =  1  : n-degree =  7 */
    /*  9*/  -1.1693085975e-05,   1.0276226561e-10,   1.9026390144e-14,
    /* 12*/  -1.3503367850e-19,  -2.6995214156e-23,   5.5167012794e-29,
    /* 15*/   8.8094838237e-33,   1.1640243939e-38,
    /*Poly NORTH :: e-degree =  2  : n-degree =  6 */
    /* 17*/  -1.5172881057e-10,   4.0760262601e-14,   1.4987126731e-18,
    /* 20*/  -1.3955116866e-22,  -3.6263094193e-29,   5.2437999641e-32,
    /* 23*/  -1.2161780010e-37,
    /*Poly NORTH :: e-degree =  3  : n-degree =  5 */
    /* 24*/  -1.2764750981e-14,   2.1200212461e-18,  -1.3703253447e-22,
    /* 27*/   3.1011000049e-27,   7.0294764634e-32,  -2.2226082853e-36,
    /*Poly NORTH :: e-degree =  4  : n-degree =  4 */
    /* 30*/  -8.4569854732e-19,  -3.2610761296e-24,  -4.2462785128e-27,
    /* 33*/   2.5378148029e-31,  -2.4054782978e-36,
    /*Poly NORTH :: e-degree =  5  : n-degree =  3 */
    /* 35*/   5.3597685427e-23,  -9.7376958506e-27,   4.5704268839e-31,
    /* 38*/  -7.2021937074e-36,
    /*Poly NORTH :: e-degree =  6  : n-degree =  2 */
    /* 39*/   5.7265042089e-27,  -4.2313262975e-31,   8.0899742558e-36,
    /*Poly NORTH :: e-degree =  7  : n-degree =  1 */
    /* 42*/   1.4133244259e-31,  -5.6582119194e-36,
    /*Poly NORTH :: e-degree =  8  : n-degree =  0 */
    /* 44*/   9.7095487316e-37,
    /*tcy*/    6879424.796540,
    /*Poly EAST  :: n-degree =  0  : e-degree =  8 */
    /*  0*/   6.1239508822e+05,   1.0000381892e+00,   1.2922161625e-10,
    /*  3*/  -6.0631287811e-14,   1.8771395832e-19,   1.3267179576e-22,
    /*  6*/   9.9812182954e-28,  -2.7545146454e-32,  -2.8957907708e-37,
    /*Poly EAST  :: n-degree =  1  : e-degree =  7 */
    /*  9*/   1.7976027263e-05,  -1.0944396157e-10,  -5.9557365983e-14,
    /* 12*/   4.9989196486e-18,   8.7274738463e-23,  -1.6283919913e-26,
    /* 15*/  -1.1699794431e-31,   1.2165550043e-36,
    /*Poly EAST  :: n-degree =  2  : e-degree =  6 */
    /* 17*/  -9.5413232357e-11,   1.2347146399e-15,   1.1740943935e-18,
    /* 20*/  -7.3121043602e-23,  -9.0630652755e-27,   8.0537699970e-31,
    /* 23*/   4.9797345655e-36,
    /*Poly EAST  :: n-degree =  3  : e-degree =  5 */
    /* 24*/  -1.7555429804e-14,   2.1617030140e-19,   1.1485395117e-22,
    /* 27*/  -5.1038765194e-27,   1.3452380176e-31,  -1.4689558466e-35,
    /*Poly EAST  :: n-degree =  4  : e-degree =  4 */
    /* 30*/   3.2665055958e-20,  -7.5096301777e-24,  -3.0909245385e-28,
    /* 33*/   7.0987272263e-32,  -2.6721532990e-37,
    /*Poly EAST  :: n-degree =  5  : e-degree =  3 */
    /* 35*/   9.2427191553e-24,  -1.7656157827e-28,  -5.8053958908e-32,
    /* 38*/   2.8049862565e-36,
    /*Poly EAST  :: n-degree =  6  : e-degree =  2 */
    /* 39*/   4.9188635561e-29,   1.3554799934e-33,  -3.9194307820e-37,
    /*Poly EAST  :: n-degree =  7  : e-degree =  1 */
    /* 42*/  -1.0795207829e-33,   2.4182493992e-38,
    /*Poly EAST  :: n-degree =  8  : e-degree =  0 */
    /* 44*/  -8.2148632410e-39,
    /*tcx*/     612286.481544
  };

  

/* fo_g_tr   ver2012.03         # page 4   30 Jan 2012 12 58 */


  /* Y&X-generelt pol. resultater
  fu50 -> utm29_etrs89
  grad:  8 pass: 5
  my  =  2.83 cm    my_loss =    +5  y_enp =  +3.9
  mx  =  2.76 cm    mx_loss =    +5  x_enp =  +4.2
  OBS =    472          red =     1  m_lim_gen:  0.283
  */

  static double FU50_U29[] = {
    /*deg*/  8.0,
    /*Poly NORTH :: e-degree =  0  : n-degree =  8 */
    /*  0*/   6.8794248443e+06,   9.9996947467e-01,  -3.0744729997e-11,
    /*  3*/  -1.5353231205e-14,   2.8217653908e-20,   1.6917408840e-23,
    /*  6*/   5.7788577568e-29,  -5.7918150550e-33,  -5.5356187285e-38,
    /*Poly NORTH :: e-degree =  1  : n-degree =  7 */
    /*  9*/   1.1692192162e-05,  -1.0275471452e-10,  -1.9022443248e-14,
    /* 12*/   1.3506288011e-19,   2.6984792524e-23,  -5.5209035123e-29,
    /* 15*/  -8.8044402091e-33,  -1.1603003521e-38,
    /*Poly NORTH :: e-degree =  2  : n-degree =  6 */
    /* 17*/   1.5167818031e-10,  -4.0751071668e-14,  -1.4984905838e-18,
    /* 20*/   1.3952284147e-22,   3.6228599503e-29,  -5.2425288876e-32,
    /* 23*/   1.2156072758e-37,
    /*Poly NORTH :: e-degree =  3  : n-degree =  5 */
    /* 24*/   1.2766006097e-14,  -2.1203297219e-18,   1.3703615609e-22,
    /* 27*/  -3.1003803619e-27,  -7.0283280765e-32,   2.2218254019e-36,
    /*Poly NORTH :: e-degree =  4  : n-degree =  4 */
    /* 30*/   8.4578455234e-19,   3.2289232828e-24,   4.2459702297e-27,
    /* 33*/  -2.5370769332e-31,   2.4048859699e-36,
    /*Poly NORTH :: e-degree =  5  : n-degree =  3 */
    /* 35*/  -5.3597903346e-23,   9.7380340843e-27,  -4.5708931097e-31,
    /* 38*/   7.2028399766e-36,
    /*Poly NORTH :: e-degree =  6  : n-degree =  2 */
    /* 39*/  -5.7260010033e-27,   4.2312667053e-31,  -8.0905322959e-36,
    /*Poly NORTH :: e-degree =  7  : n-degree =  1 */
    /* 42*/  -1.4131038941e-31,   5.6575457030e-36,
    /*Poly NORTH :: e-degree =  8  : n-degree =  0 */
    /* 44*/  -9.7074292773e-37,
    /*tcy*/    6879661.411589,
    /*Poly EAST  :: n-degree =  0  : e-degree =  8 */
    /*  0*/   6.1228650586e+05,   9.9996181213e-01,  -1.2916907733e-10,
    /*  3*/   6.0621861790e-14,  -1.8809380752e-19,  -1.3264842733e-22,
    /*  6*/  -9.9707600100e-28,   2.7558577896e-32,   2.8963014060e-37,
    /*Poly EAST  :: n-degree =  1  : e-degree =  7 */
    /*  9*/  -1.7974745626e-05,   1.0943964180e-10,   5.9540994893e-14,
    /* 12*/  -4.9976846581e-18,  -8.7213979415e-23,   1.6279246242e-26,
    /* 15*/   1.1687449149e-31,  -1.2172708009e-36,
    /*Poly EAST  :: n-degree =  2  : e-degree =  6 */
    /* 17*/   9.5405293593e-11,  -1.2369768756e-15,  -1.1733762953e-18,
    /* 20*/   7.3087197073e-23,   9.0594444131e-27,  -8.0508263055e-31,
    /* 23*/  -4.9759792810e-36,
    /*Poly EAST  :: n-degree =  3  : e-degree =  5 */
    /* 24*/   1.7553133056e-14,  -2.1604866737e-19,  -1.1483611613e-22,
    /* 27*/   5.1023799952e-27,  -1.3444596052e-31,   1.4683992857e-35,
    /*Poly EAST  :: n-degree =  4  : e-degree =  4 */
    /* 30*/  -3.2659377635e-20,   7.5123412333e-24,   3.0855809141e-28,
    /* 33*/  -7.0954421579e-32,   2.6618823787e-37,
    /*Poly EAST  :: n-degree =  5  : e-degree =  3 */
    /* 35*/  -9.2410795938e-24,   1.7645533281e-28,   5.8044131733e-32,
    /* 38*/  -2.8041612701e-36,
    /*Poly EAST  :: n-degree =  6  : e-degree =  2 */
    /* 39*/  -4.9180068862e-29,  -1.3572288136e-33,   3.9201194862e-37,
    /*Poly EAST  :: n-degree =  7  : e-degree =  1 */
    /* 42*/   1.0793303252e-33,  -2.4178377093e-38,
    /*Poly EAST  :: n-degree =  8  : e-degree =  0 */
    /* 44*/   8.2139738269e-39,
    /*tcx*/     612395.112536
  };

  /* Y&X-generelt pol. resultater
  utm29_etrs89 -> fk54
  grad:  8 pass: 5
  my  =  3.30 cm    my_loss =    +5  y_enp =  +3.1
  mx  =  3.22 cm    mx_loss =    +5  x_enp =  +3.3
  OBS =    469          red =     1  m_lim_gen:  0.330
  */

  static double U29_FK54[] = {
    /*deg*/  8.0,
    /*Poly NORTH :: e-degree =  0  : n-degree =  8 */
    /*  0*/   5.0520692675e+05,   1.0002803183e+00,   1.7888941780e-10,
    /*  3*/   1.6880867956e-14,  -2.0100535345e-19,  -1.7133875274e-23,
    /*  6*/   1.6375636637e-29,   6.4346070681e-33,   5.2508598706e-38,
    /*Poly NORTH :: e-degree =  1  : n-degree =  7 */
    /*  9*/  -2.1717241825e-05,  -2.5110445621e-09,   4.0045716447e-15,
    /* 12*/  -7.5526344449e-19,  -1.4703441000e-23,   6.5566022320e-28,
    /* 15*/   7.8653462100e-33,  -1.0715719062e-37,
    /*Poly NORTH :: e-degree =  2  : n-degree =  6 */
    /* 17*/   1.4421509734e-10,   3.7054795895e-14,  -1.2510046306e-18,
    /* 20*/  -9.4675209242e-23,   2.3918461198e-27,   2.6387489485e-32,
    /* 23*/  -9.6534743861e-37,
    /*Poly NORTH :: e-degree =  3  : n-degree =  5 */
    /* 24*/  -1.0839736894e-14,  -9.8721913079e-19,   6.9327821347e-23,
    /* 27*/   4.9865303065e-27,  -5.1542616160e-32,  -2.9642502224e-36,
    /*Poly NORTH :: e-degree =  4  : n-degree =  4 */
    /* 30*/  -1.3707251981e-18,  -2.1536217635e-23,  -2.4454732706e-27,
    /* 33*/   5.3890476103e-32,   3.3804975962e-36,
    /*Poly NORTH :: e-degree =  5  : n-degree =  3 */
    /* 35*/   4.8495931631e-23,  -2.7340668742e-27,  -1.1381605816e-31,
    /* 38*/   1.0734254950e-36,
    /*Poly NORTH :: e-degree =  6  : n-degree =  2 */
    /* 39*/   5.5756400324e-27,  -2.9158007132e-31,   5.2708535977e-36,
    /*Poly NORTH :: e-degree =  7  : n-degree =  1 */
    /* 42*/   1.1697628562e-31,  -3.8058959265e-36,
    /*Poly NORTH :: e-degree =  8  : n-degree =  0 */
    /* 44*/   6.8277323814e-37,
    /*tcy*/    6879465.208682,
    /*Poly EAST  :: n-degree =  0  : e-degree =  8 */
    /*  0*/   3.8739346100e+05,  -1.0002866171e+00,   8.2969875437e-10,
    /*  3*/   9.0712856492e-14,   3.6464938561e-18,  -1.5953913520e-22,
    /*  6*/  -9.3006189385e-27,  -1.5225434624e-31,  -8.2822766844e-37,
    /*Poly EAST  :: n-degree =  1  : e-degree =  7 */
    /*  9*/  -2.9565575000e-05,  -3.8710665403e-10,   1.2362850122e-13,
    /* 12*/  -4.3618310420e-18,  -4.2940854613e-22,   1.7833904782e-26,
    /* 15*/   8.3673832318e-31,   7.6944350839e-36,
    /*Poly EAST  :: n-degree =  2  : e-degree =  6 */
    /* 17*/  -1.3151558155e-09,  -1.8789489255e-14,  -4.7477060376e-19,
    /* 20*/   2.9477488845e-23,   8.9513359972e-27,  -7.5068593951e-31,
    /* 23*/  -1.7578184343e-35,
    /*Poly EAST  :: n-degree =  3  : e-degree =  5 */
    /* 24*/   1.2937056330e-14,   5.0389537881e-19,  -2.2064639030e-22,
    /* 27*/   5.7825504710e-27,   1.8359002109e-31,   5.3499039916e-36,
    /*Poly EAST  :: n-degree =  4  : e-degree =  4 */
    /* 30*/   4.8380978330e-20,   2.2347360052e-23,  -1.0884955835e-27,
    /* 33*/  -3.3192735895e-32,  -7.2503181306e-37,
    /*Poly EAST  :: n-degree =  5  : e-degree =  3 */
    /* 35*/  -4.2708900561e-24,  -1.9083494684e-28,   9.1560338437e-32,
    /* 38*/  -2.7995021782e-36,
    /*Poly EAST  :: n-degree =  6  : e-degree =  2 */
    /* 39*/  -6.3665353432e-29,  -1.0715185006e-32,   1.0073154243e-36,
    /*Poly EAST  :: n-degree =  7  : e-degree =  1 */
    /* 42*/  -4.9956090686e-34,  -5.0650756994e-38,
    /*Poly EAST  :: n-degree =  8  : e-degree =  0 */
    /* 44*/  -1.9941904225e-39,
    /*tcx*/     612267.169002
  };

  /* Y&X-generelt pol. resultater
  fk54 -> utm29_etrs89
  grad:  8 pass: 5
  my  =  3.30 cm    my_loss =    +5  y_enp =  +3.1
  mx  =  3.22 cm    mx_loss =    +5  x_enp =  +3.3
  OBS =    469          red =     2  m_lim_gen:  0.330
  */

  static double FK54_U29[] = {
    /*deg*/  8.0,
    /*Poly NORTH :: e-degree =  0  : n-degree =  8 */
    /*  0*/   6.8794652800e+06,   9.9971976298e-01,  -1.7892194021e-10,
    /*  3*/  -1.6869229859e-14,   2.0095473805e-19,   1.7110002227e-23,
    /*  6*/  -1.6458698468e-29,  -6.4222612805e-33,  -5.2373796262e-38,
    /*Poly NORTH :: e-degree =  1  : n-degree =  7 */
    /*  9*/  -2.1705403819e-05,  -2.5087910585e-09,   4.0094292514e-15,
    /* 12*/  -7.5515999232e-19,  -1.4676627650e-23,   6.5544260765e-28,
    /* 15*/   7.8434540125e-33,  -1.0720286903e-37,
    /*Poly NORTH :: e-degree =  2  : n-degree =  6 */
    /* 17*/  -1.4403710173e-10,  -3.7014800688e-14,   1.2517494478e-18,
    /* 20*/   9.4504341044e-23,  -2.3903298639e-27,  -2.6323266084e-32,
    /* 23*/   9.6379196210e-37,
    /*Poly NORTH :: e-degree =  3  : n-degree =  5 */
    /* 24*/  -1.0832258763e-14,  -9.8512247086e-19,   6.9176444561e-23,
    /* 27*/   4.9755070657e-27,  -5.1410110709e-32,  -2.9562115074e-36,
    /*Poly NORTH :: e-degree =  4  : n-degree =  4 */
    /* 30*/   1.3686057708e-18,   2.1481421205e-23,   2.4368350492e-27,
    /* 33*/  -5.3686596096e-32,  -3.3684471524e-36,
    /*Poly NORTH :: e-degree =  5  : n-degree =  3 */
    /* 35*/   4.8467062533e-23,  -2.7334749636e-27,  -1.1345375130e-31,
    /* 38*/   1.0733135372e-36,
    /*Poly NORTH :: e-degree =  6  : n-degree =  2 */
    /* 39*/  -5.5656681051e-27,   2.9110538224e-31,  -5.2619495260e-36,
    /*Poly NORTH :: e-degree =  7  : n-degree =  1 */
    /* 42*/   1.1668826146e-31,  -3.7961440571e-36,
    /*Poly NORTH :: e-degree =  8  : n-degree =  0 */
    /* 44*/  -6.8067325241e-37,
    /*tcy*/     505206.998038,
    /*Poly EAST  :: n-degree =  0  : e-degree =  8 */
    /*  0*/   6.1226813573e+05,  -9.9971346599e-01,   8.2963227372e-10,
    /*  3*/  -9.0629603396e-14,   3.6380432206e-18,   1.5939757551e-22,
    /*  6*/  -9.2804185305e-27,   1.5177721075e-31,  -8.2481303640e-37,
    /*Poly EAST  :: n-degree =  1  : e-degree =  7 */
    /*  9*/  -2.9547772401e-05,   3.8688435115e-10,   1.2341700577e-13,
    /* 12*/   4.3545162160e-18,  -4.2832346148e-22,  -1.7800244340e-26,
    /* 15*/   8.3453267179e-31,  -7.6684867110e-36,
    /*Poly EAST  :: n-degree =  2  : e-degree =  6 */
    /* 17*/  -1.3140425277e-09,   1.8781857300e-14,  -4.7319825027e-19,
    /* 20*/  -2.9299466894e-23,   8.9280077489e-27,   7.4848207004e-31,
    /* 23*/  -1.7526639799e-35,
    /*Poly EAST  :: n-degree =  3  : e-degree =  5 */
    /* 24*/   1.2917418895e-14,  -5.0361352515e-19,  -2.2019205191e-22,
    /* 27*/  -5.7692097949e-27,   1.8294015804e-31,  -5.3254964461e-36,
    /*Poly EAST  :: n-degree =  4  : e-degree =  4 */
    /* 30*/   4.8381669494e-20,  -2.2308208313e-23,  -1.0874833965e-27,
    /* 33*/   3.3058074971e-32,  -7.1823074284e-37,
    /*Poly EAST  :: n-degree =  5  : e-degree =  3 */
    /* 35*/  -4.2575296729e-24,   1.9093807312e-28,   9.1322186828e-32,
    /* 38*/   2.7905152989e-36,
    /*Poly EAST  :: n-degree =  6  : e-degree =  2 */
    /* 39*/  -6.3548846288e-29,   1.0688706220e-32,   1.0047392769e-36,
    /*Poly EAST  :: n-degree =  7  : e-degree =  1 */
    /* 42*/  -5.0052457904e-34,   5.0380617169e-38,
    /*Poly EAST  :: n-degree =  8  : e-degree =  0 */
    /* 44*/  -2.0022164452e-39,
    /*tcx*/     387392.493987
  };

  /* Y&X-generelt pol. resultater
  utm29_etrs89 -> fk89
  grad: 10 pass: 4
  my  =  1.51 cm    my_loss =    +8  y_enp =  +9.9
  mx  =  1.48 cm    mx_loss =    +8  x_enp =  +9.9
  OBS =    715          red =     0  m_lim_gen:  0.075
  */

  static double U29_FK89[] = {
    /*deg*/  10.0,
    /*Poly NORTH :: e-degree =  0  : n-degree = 10 */
    /*  0*/   7.1063527934e+05,   1.0002446975e+00,   1.7560781371e-10,
    /*  3*/   8.1535974297e-15,  -5.1940724317e-19,  -9.0777540994e-24,
    /*  6*/   6.4757592819e-28,   1.2219920950e-32,  -1.9569041620e-37,
    /*  9*/  -5.7047296845e-42,  -3.3497506237e-47,
    /*Poly NORTH :: e-degree =  1  : n-degree =  9 */
    /* 11*/  -3.1697572706e-05,  -2.7540312029e-09,   3.7450132806e-14,
    /* 14*/  -4.0931436162e-19,  -7.5059633565e-23,  -2.0037941581e-29,
    /* 17*/   5.2629402314e-32,   4.0212499323e-37,  -1.0055840726e-41,
    /* 20*/  -1.0901509459e-46,
    /*Poly NORTH :: e-degree =  2  : n-degree =  8 */
    /* 21*/  -8.9069244655e-10,   1.6759690651e-14,   3.7938673309e-18,
    /* 24*/  -2.8721477191e-24,  -6.1328392039e-27,  -7.0937969439e-32,
    /* 27*/   2.5658100193e-36,   4.8343746366e-41,   1.7172167215e-46,
    /*Poly NORTH :: e-degree =  3  : n-degree =  7 */
    /* 30*/   1.2093995115e-14,  -4.2669495351e-18,   2.7490613686e-23,
    /* 33*/   1.0633053170e-26,  -4.1557678337e-32,  -5.6572254446e-36,
    /* 36*/  -2.1889789784e-41,   2.5704307349e-46,
    /*Poly NORTH :: e-degree =  4  : n-degree =  6 */
    /* 38*/   7.3986334428e-18,  -7.8592544167e-22,   1.3925969661e-27,
    /* 41*/   9.6441957785e-31,  -4.3301458566e-37,  -3.5315326561e-40,
    /* 44*/  -2.7231680821e-45,
    /*Poly NORTH :: e-degree =  5  : n-degree =  5 */
    /* 45*/   3.5853169295e-22,  -2.3899417474e-26,  -2.3594385620e-31,
    /* 48*/   2.0473422329e-35,   9.9407383094e-41,  -3.7660948496e-45,
    /*Poly NORTH :: e-degree =  6  : n-degree =  4 */
    /* 51*/  -1.5256010582e-27,   1.2490115018e-30,  -7.2927376677e-35,
    /* 54*/   3.7076541649e-40,   2.3125315048e-44,
    /*Poly NORTH :: e-degree =  7  : n-degree =  3 */
    /* 56*/  -6.0595941382e-31,   8.7299916970e-35,  -3.0539826700e-39,
    /* 59*/   2.4672920636e-44,
    /*Poly NORTH :: e-degree =  8  : n-degree =  2 */
    /* 60*/  -2.0594629710e-35,   1.7679512049e-39,  -3.1835432669e-44,
    /*Poly NORTH :: e-degree =  9  : n-degree =  1 */
    /* 63*/  -3.0626227592e-40,   1.2140756108e-44,
    /*Poly NORTH :: e-degree = 10  : n-degree =  0 */
    /* 65*/  -1.7883993198e-45,
    /*tcy*/    6884892.302740,
    /*Poly EAST  :: n-degree =  0  : e-degree = 10 */
    /*  0*/   5.8403112397e+05,  -1.0002499735e+00,   1.0462114095e-09,
    /*  3*/   3.8346137186e-14,   4.3986548477e-18,   9.0532119046e-23,
    /*  6*/  -1.0852456692e-26,  -9.9252193443e-31,  -3.6483144897e-35,
    /*  9*/  -6.2888233249e-40,  -4.1205998134e-45,
    /*Poly EAST  :: n-degree =  1  : e-degree =  9 */
    /* 11*/  -3.1566686661e-05,   1.8619775436e-10,   7.6946790684e-14,
    /* 14*/  -2.1967618318e-18,  -6.4738161333e-22,  -1.0527565092e-26,
    /* 17*/   2.1706843207e-30,   1.2651155145e-34,   2.6515296921e-39,
    /* 20*/   2.0086843573e-44,
    /*Poly EAST  :: n-degree =  2  : e-degree =  8 */
    /* 21*/  -1.4225235867e-09,  -1.1979510783e-15,   3.0666429588e-19,
    /* 24*/  -1.3921407511e-22,   1.8823362834e-26,   5.8411863903e-31,
    /* 27*/  -9.7656931223e-35,  -4.0203746801e-39,  -3.2932159319e-44,
    /*Poly EAST  :: n-degree =  3  : e-degree =  7 */
    /* 30*/   1.3002111796e-14,  -7.5400222811e-19,  -2.3442223060e-22,
    /* 33*/   6.6119208292e-27,   9.3227269299e-31,  -1.7210772752e-35,
    /* 36*/  -7.9921934523e-40,   2.3877924864e-44,
    /*Poly EAST  :: n-degree =  4  : e-degree =  6 */
    /* 38*/   1.0855966850e-19,  -3.1077967933e-23,  -2.2260680109e-27,
    /* 41*/   1.4992828827e-31,  -1.8979443242e-35,  -4.3114588292e-41,
    /* 44*/   5.6162351145e-44,
    /*Poly EAST  :: n-degree =  5  : e-degree =  5 */
    /* 45*/  -1.2831699156e-23,   3.6220155506e-28,   1.8210135015e-31,
    /* 48*/  -2.7449314450e-36,  -3.5250339861e-40,   1.3174426980e-44,
    /*Poly EAST  :: n-degree =  6  : e-degree =  4 */
    /* 51*/  -1.9352574291e-28,   3.0009791050e-32,   2.7867762934e-36,
    /* 54*/  -9.4615259849e-41,   2.6156032197e-46,
    /*Poly EAST  :: n-degree =  7  : e-degree =  3 */
    /* 56*/   3.5480723428e-33,   1.0163897413e-37,  -2.8228270991e-41,
    /* 59*/  -9.0085491626e-46,
    /*Poly EAST  :: n-degree =  8  : e-degree =  2 */
    /* 60*/   7.6386153586e-38,  -8.8135276081e-42,  -4.9942257324e-46,
    /*Poly EAST  :: n-degree =  9  : e-degree =  1 */
    /* 63*/   9.5336253070e-44,  -8.6186874629e-47,
    /*Poly EAST  :: n-degree = 10  : e-degree =  0 */
    /* 65*/  -2.9093981205e-48,
    /*tcx*/     615628.465396
  };

  /* Y&X-generelt pol. resultater
  fk89 -> utm29_etrs89
  grad: 10 pass: 4
  my  =  1.51 cm    my_loss =    +8  y_enp =  +9.9
  mx  =  1.48 cm    mx_loss =    +8  x_enp = +10.2
  OBS =    715          red =     0  m_lim_gen:  0.075
  */

  static double FK89_U29[] = {
    /*deg*/  10.0,
    /*Poly NORTH :: e-degree =  0  : n-degree = 10 */
    /*  0*/   6.8848920236e+06,   9.9975536348e-01,  -1.7565123284e-10,
    /*  3*/  -8.1499580415e-15,   5.1897975698e-19,   9.0679187278e-24,
    /*  6*/  -6.4669979487e-28,  -1.2201603287e-32,   1.9531821520e-37,
    /*  9*/   5.6932211917e-42,   3.3424129498e-47,
    /*Poly NORTH :: e-degree =  1  : n-degree =  9 */
    /* 11*/  -3.1682520901e-05,  -2.7520561017e-09,   3.7426462292e-14,
    /* 14*/  -4.0820779859e-19,  -7.4975337739e-23,  -2.1109825851e-29,
    /* 17*/   5.2539369747e-32,   4.0199517383e-37,  -1.0025516186e-41,
    /* 20*/  -1.0873045625e-46,
    /*Poly NORTH :: e-degree =  2  : n-degree =  8 */
    /* 21*/   8.9002292674e-10,  -1.6698011234e-14,  -3.7900266164e-18,
    /* 24*/   2.7930587309e-24,   6.1229612251e-27,   7.0849075920e-32,
    /* 27*/  -2.5597755505e-36,  -4.8219668659e-41,  -1.7114845218e-46,
    /*Poly NORTH :: e-degree =  3  : n-degree =  7 */
    /* 30*/   1.2117485546e-14,  -4.2647429713e-18,   2.7355378949e-23,
    /* 33*/   1.0620059703e-26,  -4.1264367505e-32,  -5.6458018213e-36,
    /* 36*/  -2.1976705146e-41,   2.5478883026e-46,
    /*Poly NORTH :: e-degree =  4  : n-degree =  6 */
    /* 38*/  -7.3903665045e-18,   7.8456276445e-22,  -1.3669049859e-27,
    /* 41*/  -9.6254035413e-31,   4.1145052610e-37,   3.5220243249e-40,
    /* 44*/   2.7191179708e-45,
    /*Poly NORTH :: e-degree =  5  : n-degree =  5 */
    /* 45*/   3.5784726125e-22,  -2.3830757291e-26,  -2.3608203487e-31,
    /* 48*/   2.0390039133e-35,   9.9726785338e-41,  -3.7435501658e-45,
    /*Poly NORTH :: e-degree =  6  : n-degree =  4 */
    /* 51*/   1.5318148003e-27,  -1.2469246238e-30,   7.2711825515e-35,
    /* 54*/  -3.6763739770e-40,  -2.3067346627e-44,
    /*Poly NORTH :: e-degree =  7  : n-degree =  3 */
    /* 56*/  -6.0479653547e-31,   8.7068978212e-35,  -3.0436446950e-39,
    /* 59*/   2.4567717767e-44,
    /*Poly NORTH :: e-degree =  8  : n-degree =  2 */
    /* 60*/   2.0540707435e-35,  -1.7622447337e-39,   3.1714212236e-44,
    /*Poly NORTH :: e-degree =  9  : n-degree =  1 */
    /* 63*/  -3.0529222290e-40,   1.2095243092e-44,
    /*Poly NORTH :: e-degree = 10  : n-degree =  0 */
    /* 65*/   1.7818748571e-45,
    /*tcy*/     710635.000077,
    /*Poly EAST  :: n-degree =  0  : e-degree = 10 */
    /*  0*/   6.1562917300e+05,  -9.9975008896e-01,   1.0454602153e-09,
    /*  3*/  -3.8334505700e-14,   4.3939317783e-18,  -9.0279545687e-23,
    /*  6*/  -1.0841282557e-26,   9.9051421445e-31,  -3.6387986798e-35,
    /*  9*/   6.2695359772e-40,  -4.1063117302e-45,
    /*Poly EAST  :: n-degree =  1  : e-degree =  9 */
    /* 11*/  -3.1550319972e-05,  -1.8591469839e-10,   7.6867846597e-14,
    /* 14*/   2.1955732364e-18,  -6.4646242284e-22,   1.0498280118e-26,
    /* 17*/   2.1668136514e-30,  -1.2621290301e-34,   2.6440281600e-39,
    /* 20*/  -2.0021749962e-44,
    /*Poly EAST  :: n-degree =  2  : e-degree =  8 */
    /* 21*/  -1.4214894799e-09,   1.2013339307e-15,   3.0590585535e-19,
    /* 24*/   1.3903244994e-22,   1.8792909210e-26,  -5.8303620062e-31,
    /* 27*/  -9.7437798894e-35,   4.0104512619e-39,  -3.2844872806e-44,
    /*Poly EAST  :: n-degree =  3  : e-degree =  7 */
    /* 30*/   1.2990993709e-14,   7.5343880340e-19,  -2.3408635630e-22,
    /* 33*/  -6.6026822824e-27,   9.3034218508e-31,   1.7179326496e-35,
    /* 36*/  -7.9678165149e-40,  -2.3835709264e-44,
    /*Poly EAST  :: n-degree =  4  : e-degree =  6 */
    /* 38*/   1.0849564933e-19,   3.1053351775e-23,  -2.2211809228e-27,
    /* 41*/  -1.4961343732e-31,  -1.8947162818e-35,   4.3344996503e-41,
    /* 44*/   5.6003853506e-44,
    /*Poly EAST  :: n-degree =  5  : e-degree =  5 */
    /* 45*/  -1.2816130783e-23,  -3.6214734660e-28,   1.8178829355e-31,
    /* 48*/   2.7407242690e-36,  -3.5159353694e-40,  -1.3142026225e-44,
    /*Poly EAST  :: n-degree =  6  : e-degree =  4 */
    /* 51*/  -1.9328588243e-28,  -2.9979475719e-32,   2.7803525486e-36,
    /* 54*/   9.4330351796e-41,   2.6544691330e-46,
    /*Poly EAST  :: n-degree =  7  : e-degree =  3 */
    /* 56*/   3.5432021920e-33,  -1.0127420419e-37,  -2.8190264363e-41,
    /* 59*/   8.9747789172e-46,
    /*Poly EAST  :: n-degree =  8  : e-degree =  2 */
    /* 60*/   7.6289299510e-38,   8.8060514967e-42,  -4.9842644311e-46,
    /*Poly EAST  :: n-degree =  9  : e-degree =  1 */
    /* 63*/   9.5516807669e-44,   8.6079232774e-47,
    /*Poly EAST  :: n-degree = 10  : e-degree =  0 */
    /* 65*/  -2.9025701465e-48,
    /*tcx*/     584030.416203
  };

  /* Collect start values */
  N = N_in;
  E = E_in;
  switch (mode + ((direct > 0) ? 0 : 1)) {
  case 3: /* utm29_etrs89 -> fu50 (direct) */
    cb = U29_FU50;  cw = FU50_U29;  break;
  case 4: /* fu50 -> utm29_etrs89 (inverse) */
    cb = FU50_U29;  cw = U29_FU50;  break;
  case 5: /* utm29_etrs89 -> fk54 (direct) */
    cb = U29_FK54;  cw = FK54_U29;  break;
  case 6: /* fk54 -> utm29_etrs89 (inverse) */
    cb = FK54_U29;  cw = U29_FK54;  break;
  case 7: /* utm29_etrs89 -> fk89 (direct) */
    cb = U29_FK89;  cw = FK89_U29;  break;
  case 8: /* fk89 -> utm29_etrs89 (inverse) */
    cb = FK89_U29;  cw = U29_FK89;  break;
  default: 
    return(t_status(tr_error, usertxt, "fo_g_tr", TRF_PROGR_, 
           "m ", "", N, E, N - N_in, E - E_in));
  }

  if (direct) {
    /* Transformation loop */
    for (i = -1; i <= 1 && res >= TRF_TOLLE_; ++i)
      if (i) {
        /* Prepare for double Horner */
        g   = (int) *cb;
        sz  = (g + 1)*(g + 2)/2 + 1;
        tcy = cb + sz;
        tcx = tcy  + sz;
        /* Double Horner's scheme */
        /* N = n*Cy*e -> yout, E = e*Cx*n -> xout */

        n   = N - *tcy;
        e   = E - *tcx;

        if (fabs(n) < COORDLIM && fabs(e) < COORDLIM) {
          for (  r = g, N = *--tcy, E = *--tcx; r >  0; r--) {
            for (c = g, u = *--tcy, v = *--tcx; c >= r; c--) {
              u = n*u + *--tcy;
              v = e*v + *--tcx;
            }
            N = e*N + u;
            E = n*E + v;
          }
        }
        else res = TRF_AREA_;
      }
      else { /* collect output coord,switch to reverse checking */
        *N_out = N;
        *E_out = E;
        cb     = cw; /* reverse direction */
      }

    if (res >= TRF_TOLLE_) {
      if (fabs(N - N_in) < tol && fabs(E - E_in) < tol) return (0);
      else
      res = TRF_TOLLE_;
    }
  }
  else res = TRF_PROGR_;  /* UNDEFINED DIRECTION */

  return(t_status(tr_error, usertxt, "fo_g_tr", res, 
         "m ", "", N, E, N - N_in, E - E_in));

#undef   COORDLIM
}
